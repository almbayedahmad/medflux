# Production logging profile. Extends the base configuration with sampling,
# rate limiting, and duplicate suppression to keep JSON logs lean under load.
meta:
  version: 1
  id: logging_config_prod

logging:
  version: 1
  disable_existing_loggers: false

  formatters:
    standard:
      format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
      datefmt: "%Y-%m-%d %H:%M:%S"
    json:
      '()': core.logging.json_formatter.JSONLogFormatter

  filters:
    redaction:
      '()': core.logging.redaction.RedactionFilter
    context:
      '()': core.logging.context.ContextFilter
    sampling:
      '()': core.logging.filters.SamplingFilter
    ratelimit:
      '()': core.logging.filters.RateLimitFilter
    duplicate:
      '()': core.logging.filters.DuplicateFilter

  handlers:
    console:
      class: logging.StreamHandler
      level: INFO
      formatter: json
      stream: ext://sys.stdout
      filters: [context, redaction, duplicate, sampling, ratelimit]

    json_file:
      class: logging.handlers.RotatingFileHandler
      level: INFO
      formatter: json
      filename: "logs/current.jsonl"
      maxBytes: 20971520
      backupCount: 10
      encoding: "utf-8"
      delay: true
      filters: [context, redaction, duplicate]

    json_file_daily:
      class: logging.handlers.TimedRotatingFileHandler
      level: INFO
      formatter: json
      filename: "logs/current.jsonl"
      when: midnight
      interval: 1
      backupCount: 14
      encoding: "utf-8"
      utc: true
      delay: true
      filters: [context, redaction, duplicate]

  root:
    level: INFO
    handlers: [console, json_file]

  loggers:
    uvicorn.access:
      level: WARNING
    PIL:
      level: WARNING
    pdfminer:
      level: WARNING
