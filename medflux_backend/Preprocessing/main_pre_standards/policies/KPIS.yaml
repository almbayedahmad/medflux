# Key Performance Indicators

# This file defines key performance indicators to track for each stage
# It ensures track KPIs and improve performance

meta:
  version: 3
  id: kpis
  updated_at: "{{CREATED_AT}}"
  description: "Key performance indicators to track for each stage"

kpis:
  # Common KPIs for all stages
  common:
    - name: "processed_items_count"
      description: "Number of items processed"
      unit: "count"
      type: "counter"
      target: "> 0"
      critical: "= 0"

    - name: "avg_latency_per_unit_ms"
      description: "Average latency per processing unit"
      unit: "milliseconds"
      type: "gauge"
      target: "< 30"
      warning: "> 30"
      critical: "> 60"

    - name: "low_confidence_ratio"
      description: "Ratio of low confidence results"
      unit: "ratio"
      type: "gauge"
      target: "< 0.05"
      warning: "> 0.05"
      critical: "> 0.1"

    - name: "error_rate"
      description: "Error rate percentage"
      unit: "percentage"
      type: "gauge"
      target: "< 1%"
      warning: "> 1%"
      critical: "> 5%"

    - name: "throughput_items_per_second"
      description: "Items processed per second"
      unit: "items/second"
      type: "gauge"
      target: "> 10"
      warning: "< 10"
      critical: "< 5"

    - name: "memory_usage_mb"
      description: "Memory usage in megabytes"
      unit: "megabytes"
      type: "gauge"
      target: "< 512"
      warning: "> 512"
      critical: "> 1024"

    - name: "cpu_usage_percent"
      description: "CPU usage percentage"
      unit: "percentage"
      type: "gauge"
      target: "< 80%"
      warning: "> 80%"
      critical: "> 95%"

    - name: "disk_usage_percent"
      description: "Disk usage percentage"
      unit: "percentage"
      type: "gauge"
      target: "< 80%"
      warning: "> 80%"
      critical: "> 95%"

  # Stage-specific KPIs
  by_stage_type:
    # Aggregation stage KPIs
    aggregation:
      - name: "deduplicated_items_count"
        description: "Number of deduplicated items"
        unit: "count"
        type: "counter"
        target: "> 0"
        critical: "= 0"

      - name: "conflicts_count"
        description: "Number of conflicts detected"
        unit: "count"
        type: "counter"
        target: "< 10"
        warning: "> 10"
        critical: "> 50"

      - name: "duplicate_ratio"
        description: "Ratio of duplicate items"
        unit: "ratio"
        type: "gauge"
        target: "< 0.1"
        warning: "> 0.1"
        critical: "> 0.2"

    # Cleaning stage KPIs
    cleaning:
      - name: "normalized_tokens_count"
        description: "Number of normalized tokens"
        unit: "count"
        type: "counter"
        target: "> 0"
        critical: "= 0"

      - name: "fixed_hyphenations_count"
        description: "Number of fixed hyphenations"
        unit: "count"
        type: "counter"
        target: "> 0"
        critical: "= 0"

      - name: "cleaning_accuracy"
        description: "Cleaning accuracy percentage"
        unit: "percentage"
        type: "gauge"
        target: "> 95%"
        warning: "< 95%"
        critical: "< 90%"

    # Segmentation stage KPIs
    segmentation:
      - name: "segments_count"
        description: "Number of segments created"
        unit: "count"
        type: "counter"
        target: "> 0"
        critical: "= 0"

      - name: "avg_segment_length"
        description: "Average segment length"
        unit: "characters"
        type: "gauge"
        target: "50-500"
        warning: "< 50 or > 500"
        critical: "< 10 or > 1000"

      - name: "segmentation_quality"
        description: "Segmentation quality score"
        unit: "score"
        type: "gauge"
        target: "> 0.8"
        warning: "< 0.8"
        critical: "< 0.6"

    # Indexing stage KPIs
    indexing:
      - name: "indexed_items_count"
        description: "Number of indexed items"
        unit: "count"
        type: "counter"
        target: "> 0"
        critical: "= 0"

      - name: "index_size_mb"
        description: "Index size in megabytes"
        unit: "megabytes"
        type: "gauge"
        target: "< 100"
        warning: "> 100"
        critical: "> 500"

      - name: "index_build_time_ms"
        description: "Index build time"
        unit: "milliseconds"
        type: "gauge"
        target: "< 1000"
        warning: "> 1000"
        critical: "> 5000"

    # Readers stage KPIs
    readers:
      - name: "ocr_accuracy"
        description: "OCR accuracy percentage"
        unit: "percentage"
        type: "gauge"
        target: "> 90%"
        warning: "< 90%"
        critical: "< 80%"

      - name: "table_detection_rate"
        description: "Table detection rate"
        unit: "percentage"
        type: "gauge"
        target: "> 85%"
        warning: "< 85%"
        critical: "< 70%"

      - name: "language_detection_accuracy"
        description: "Language detection accuracy"
        unit: "percentage"
        type: "gauge"
        target: "> 95%"
        warning: "< 95%"
        critical: "< 90%"

      - name: "text_extraction_completeness"
        description: "Text extraction completeness"
        unit: "percentage"
        type: "gauge"
        target: "> 95%"
        warning: "< 95%"
        critical: "< 90%"

      - name: "processing_time_per_page_ms"
        description: "Processing time per page"
        unit: "milliseconds"
        type: "gauge"
        target: "< 5000"
        warning: "> 5000"
        critical: "> 10000"

  # Quality KPIs
  quality:
    - name: "overall_quality_score"
      description: "Overall quality score"
      unit: "score"
      type: "gauge"
      target: "> 0.8"
      warning: "< 0.8"
      critical: "< 0.6"

    - name: "user_satisfaction_score"
      description: "User satisfaction score"
      unit: "score"
      type: "gauge"
      target: "> 4.0"
      warning: "< 4.0"
      critical: "< 3.0"

    - name: "data_accuracy"
      description: "Data accuracy percentage"
      unit: "percentage"
      type: "gauge"
      target: "> 95%"
      warning: "< 95%"
      critical: "< 90%"

    - name: "consistency_score"
      description: "Consistency score"
      unit: "score"
      type: "gauge"
      target: "> 0.9"
      warning: "< 0.9"
      critical: "< 0.8"

  # Reliability KPIs
  reliability:
    - name: "uptime_percentage"
      description: "System uptime percentage"
      unit: "percentage"
      type: "gauge"
      target: "> 99%"
      warning: "< 99%"
      critical: "< 95%"

    - name: "mean_time_to_recovery"
      description: "Mean time to recovery"
      unit: "minutes"
      type: "gauge"
      target: "< 5"
      warning: "> 5"
      critical: "> 15"

    - name: "failure_rate"
      description: "Failure rate percentage"
      unit: "percentage"
      type: "gauge"
      target: "< 0.1%"
      warning: "> 0.1%"
      critical: "> 1%"

    - name: "availability_score"
      description: "Availability score"
      unit: "score"
      type: "gauge"
      target: "> 0.99"
      warning: "< 0.99"
      critical: "< 0.95"

  # Security KPIs
  security:
    - name: "security_vulnerabilities_count"
      description: "Number of security vulnerabilities"
      unit: "count"
      type: "counter"
      target: "= 0"
      warning: "> 0"
      critical: "> 5"

    - name: "failed_authentication_attempts"
      description: "Failed authentication attempts"
      unit: "count"
      type: "counter"
      target: "< 10"
      warning: "> 10"
      critical: "> 50"

    - name: "data_breach_incidents"
      description: "Data breach incidents"
      unit: "count"
      type: "counter"
      target: "= 0"
      warning: "> 0"
      critical: "> 0"

    - name: "security_compliance_score"
      description: "Security compliance score"
      unit: "score"
      type: "gauge"
      target: "> 0.95"
      warning: "< 0.95"
      critical: "< 0.90"

  # Cost KPIs
  cost:
    - name: "cost_per_item"
      description: "Cost per processed item"
      unit: "currency"
      type: "gauge"
      target: "< 0.01"
      warning: "> 0.01"
      critical: "> 0.05"

    - name: "infrastructure_cost"
      description: "Infrastructure cost"
      unit: "currency"
      type: "gauge"
      target: "< 100"
      warning: "> 100"
      critical: "> 500"

    - name: "operational_cost"
      description: "Operational cost"
      unit: "currency"
      type: "gauge"
      target: "< 50"
      warning: "> 50"
      critical: "> 200"

    - name: "cost_efficiency_ratio"
      description: "Cost efficiency ratio"
      unit: "ratio"
      type: "gauge"
      target: "> 0.8"
      warning: "< 0.8"
      critical: "< 0.6"

  # Innovation KPIs
  innovation:
    - name: "feature_adoption_rate"
      description: "Feature adoption rate"
      unit: "percentage"
      type: "gauge"
      target: "> 50%"
      warning: "< 50%"
      critical: "< 25%"

    - name: "innovation_index"
      description: "Innovation index"
      unit: "score"
      type: "gauge"
      target: "> 0.7"
      warning: "< 0.7"
      critical: "< 0.5"

    - name: "time_to_market"
      description: "Time to market"
      unit: "days"
      type: "gauge"
      target: "< 30"
      warning: "> 30"
      critical: "> 60"

    - name: "research_development_ratio"
      description: "Research and development ratio"
      unit: "percentage"
      type: "gauge"
      target: "> 10%"
      warning: "< 10%"
      critical: "< 5%"

  # KPI collection and reporting
  collection:
    # Collection frequency
    frequency:
      real_time: true
      hourly: true
      daily: true
      weekly: true
      monthly: true

    # Collection methods
    methods:
      metrics: true
      logs: true
      traces: true
      events: true
      surveys: true

    # Collection sources
    sources:
      application: true
      infrastructure: true
      user_feedback: true
      external_apis: true
      monitoring_tools: true

  # KPI reporting
  reporting:
    # Report formats
    formats:
      json: true
      csv: true
      excel: true
      pdf: true
      html: true

    # Report delivery
    delivery:
      email: true
      webhook: true
      dashboard: true
      api: true
      file: true

    # Report scheduling
    scheduling:
      real_time: true
      hourly: true
      daily: true
      weekly: true
      monthly: true
      on_demand: true

  # KPI alerting
  alerting:
    # Alert levels
    levels:
      info: true
      warning: true
      critical: true
      emergency: true

    # Alert channels
    channels:
      email: true
      sms: true
      slack: true
      webhook: true
      pagerduty: true

    # Alert rules
    rules:
      threshold_based: true
      anomaly_detection: true
      trend_analysis: true
      custom_rules: true
